!function(a){function e(a){var e="",s="";return"true"!=a.is_template?!1:(e=a.type_name+" #"+a.template,s=a.type+" #"+a.template,[e,s])}function s(a){a.prop("disabled",!0).addClass("disabled").removeClass("enabled")}function i(a){a.prop("disabled",!1).addClass("enabled").removeClass("disabled")}function t(a){var e=a.val();return 0!=e.length?!0:!1}a(window).load(function(){function l(){jQuery.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"cherry_live_start_chat",chat_nick:c.val(),chat_email:h.val(),chat_order:_.val(),chat_subject:v.val(),chat_message:u.val(),chat_product:a("#chat-product-type").val()},success:function(e){if("error"==e.status)a(".cherry-chat-msg-error").show();else if(n(),"chat"==e.type){var s,i,t=682,l=523,d=e.url;s=window.screen.width/2-(t/2+10),i=window.screen.height/2-(l/2+50),window.open(d,"Chat","status=no,height="+l+",width="+t+",resizable=no,left="+s+",top="+i+",screenX="+s+",screenY="+i+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no"),o.removeClass("active").animate({bottom:-f.outerHeight()},200),a(".chat_in").hide(),a(".chat_out").show()}else o.addClass("ticket-send"),a(".cherry-chat-msg-success").show()},async:!1})}function d(){jQuery.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"check_order",chat_order:_.val()},beforeSend:function(){a("#chat-product-type").remove(),a(".form-group-preloader .LV_validation_message").remove(),s(g)},success:function(i){"success"==i.status?(_.addClass("checked"),1==i.count?(a("#pr-type-group").append('<input type="hidden" name="chat-product-type" id="chat-product-type" value="">'),data=e(i.order_data[0]),a("#chat-product-type").val(data[1]),l()):i.count>1&&(a("#pr-type-group").append('<select name="chat-product-type" id="chat-product-type" required tabindex="2"><option value="">'+message_text.select_default+"</option></select>").removeClass("hidden"),a.each(i.order_data,function(s,i){data=e(i),a("#chat-product-type").append(a("<option></option>").attr("value",data[1]).text(data[0]))}),C.find(g).hide(),C.find(m).show()),o.hasClass("online")?_.removeClass("LV_invalid_field").after('<span class="LV_validation_message LV_valid"><i></i></span>'):_.removeClass("LV_invalid_field")):o.hasClass("online")?(_.addClass("LV_invalid_field").after('<span class="LV_validation_message LV_invalid"><b>'+message_text.order_bad+"</b><i></i></span>"),s(g)):(_.addClass("LV_invalid_field").after('<span class="LV_validation_message LV_invalid"><b>'+message_text.order_bad+"</b></span>"),s(m)),p.hide()},async:!1})}function n(){c.val("").removeClass("LV_valid_field LV_invalid_field"),h.val("").removeClass("LV_valid_field LV_invalid_field"),_.val("").removeClass("LV_valid_field LV_invalid_field checked"),v.val("").removeClass("LV_valid_field LV_invalid_field"),u.val("").removeClass("LV_valid_field LV_invalid_field"),a(o).find(".LV_validation_message").remove(),a("#pr-type-group").addClass("hidden"),s(m),s(g),o.hasClass("order")?(m.hide(),g.show()):(m.show(),g.hide()),_.removeClass("checked")}{var o=a("#cherry-chat-dialog"),r=a(".chat_box_heading"),c=a("#chat-nick"),h=a("#chat-email"),_=a("#chat-order-id"),v=a("#chat-subject"),u=a("#chat-message"),f=a(".chat_box_body"),p=a(".preloader"),m=a(".start_chat"),g=a(".start_chat_order"),C=a(".cherry-chat-accordion-item.first-item");a(".cherry-chat-accordion-item.second-item")}o.delay(1200).animate({bottom:-(o.height()-r.height())},400),m.on("click",function(){if(o.hasClass("online")||_.hasClass("checked"))l();else{var e=a.trim(_.val());e.length>=7?(p.show(),setTimeout(function(){d()},100)):0!=e.length?(_.addClass("LV_invalid_field"),0==a(".form-group-preloader .LV_validation_message").length&&_.after('<span class="LV_validation_message LV_invalid"><b>'+message_text.order_fail+"</b></span>"),s(m)):l()}}),r.on("click",function(e){e.preventDefault(),a(this).hasClass("chat_out")?(o.addClass("active").animate({bottom:0},200,function(){o.hasClass("online")&&o.hasClass("order")&&!_.hasClass("checked")?_.focus():c.focus()}),a(".chat_out").hide(),a(".chat_in").show()):a(this).hasClass("chat_in")&&(a(".cherry-chat-msg").hide(),o.removeClass("active").removeClass("ticket-send").animate({bottom:-f.outerHeight()},200),a(".chat_in").hide(),a(".chat_out").show())}),a(".order-id-switch").on("click",function(a){a.preventDefault(),o.toggleClass("order"),n()}),c.on("keyup",function(){1==t(a(this))?o.hasClass("online")?h.hasClass("LV_valid_field")&&i(m):h.hasClass("LV_valid_field")&&v.hasClass("LV_valid_field")&&u.hasClass("LV_valid_field")&&i(m):s(m)}),h.on("keyup",function(){1==t(a(this))?o.hasClass("online")?c.hasClass("LV_valid_field")&&i(m):c.hasClass("LV_valid_field")&&v.hasClass("LV_valid_field")&&u.hasClass("LV_valid_field")&&i(m):s(m)}),v.on("keyup",function(){1==t(a(this))?c.hasClass("LV_valid_field")&&h.hasClass("LV_valid_field")&&u.hasClass("LV_valid_field")&&i(m):s(m)}),u.on("keyup",function(){1==t(a(this))?c.hasClass("LV_valid_field")&&h.hasClass("LV_valid_field")&&v.hasClass("LV_valid_field")&&i(m):s(m)});var V=new LiveValidation("chat-nick",{validMessage:"Ok",onlyOnBlur:!0,onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass(),s(m)}}),L=new LiveValidation("chat-email",{validMessage:"Ok",onlyOnBlur:!0,onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass(),s(m)}});if(V.add(Validate.Format,{pattern:/^[a-zA-Z][0-9a-zA-Z]{1,50}$/,failureMessage:message_text.name_fail}),L.add(Validate.Email,{failureMessage:message_text.email_fail}),o.hasClass("online")){var y=new LiveValidation("chat-order-id",{validMessage:"Ok",onlyOnBlur:!1,onValid:function(){var e=a.trim(_.val());0!=e.length?(this.removeMessage(),this.removeFieldClass(),i(g)):s(g)},onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass(),s(g)}});y.add(Validate.Format,{failureMessage:message_text.order_fail,pattern:/^[0-9a-zA-Z]{6,50}$/})}else{_.on("keyup",function(){1==t(a(this))?c.hasClass("LV_valid_field")&&h.hasClass("LV_valid_field")&&v.hasClass("LV_valid_field")&&u.hasClass("LV_valid_field")&&i(m):s(m)});var b=new LiveValidation("chat-subject",{validMessage:"Ok",onlyOnBlur:!0,onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass(),s(m)}}),w=new LiveValidation("chat-message",{validMessage:"Ok",onlyOnBlur:!0,onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass(),s(m)}});b.add(Validate.Length,{tooShortMessage:message_text.subject_fail,minimum:1}),w.add(Validate.Length,{tooShortMessage:message_text.message_fail,minimum:1})}a("body").on("change","#chat-product-type",function(){""!==a(this).val()?(a(this).after('<span class="LV_validation_message LV_valid LV_valid_select"><i></i></span>'),i(m)):(a(".LV_valid_select").remove(),s(m))}),g.on("click",function(){p.show(),setTimeout(function(){d()},100)})})}(jQuery);